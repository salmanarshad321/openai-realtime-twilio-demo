(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{802:function(e,t,s){Promise.resolve().then(s.bind(s,3237))},3237:function(e,t,s){"use strict";s.d(t,{default:function(){return ex}});var a=s(7437),l=s(2265),n=s(1538),r=s(2218),i=s(4839),o=s(6164);function c(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,o.m6)((0,i.W)(t))}let d=(0,r.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),m=l.forwardRef((e,t)=>{let{className:s,variant:l,size:r,asChild:i=!1,...o}=e,m=i?n.g7:"button";return(0,a.jsx)(m,{className:c(d({variant:l,size:r,className:s})),ref:t,...o})});m.displayName="Button";var u=s(6540),p=s(7138),x=()=>(0,a.jsxs)("div",{className:"flex justify-between items-center px-6 py-4 border-b",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"Call Assistant"})}),(0,a.jsx)("div",{className:"flex gap-3",children:(0,a.jsx)(m,{variant:"ghost",size:"sm",children:(0,a.jsxs)(p.default,{href:"https://platform.openai.com/docs/guides/realtime",className:"flex items-center gap-2",target:"_blank",rel:"noopener noreferrer",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"Documentation"]})})})]}),f=s(8137);let h=f.fC,g=f.xz,j=f.h_;f.x8;let N=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(f.aV,{ref:t,className:c("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...l})});N.displayName=f.aV.displayName;let v=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(j,{children:[(0,a.jsx)(N,{}),(0,a.jsx)(f.VY,{ref:t,className:c("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:l})]})});v.displayName=f.VY.displayName;let y=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:c("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};y.displayName="DialogHeader";let b=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:c("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};b.displayName="DialogFooter";let w=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(f.Dx,{ref:t,className:c("text-lg font-semibold leading-none tracking-tight",s),...l})});w.displayName=f.Dx.displayName;let S=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(f.dk,{ref:t,className:c("text-sm text-muted-foreground",s),...l})});S.displayName=f.dk.displayName;let k=l.forwardRef((e,t)=>{let{className:s,type:l,...n}=e;return(0,a.jsx)("input",{type:l,className:c("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...n})});k.displayName="Input";var _=s(3274),C=s(2940),R=s(8165),O=s(1848),T=s(2421),E=s(4392),Z=s(2468);let J=O.fC;O.ZA;let z=O.B4,I=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(O.xz,{ref:t,className:c("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[l,(0,a.jsx)(O.JO,{asChild:!0,children:(0,a.jsx)(T.Z,{className:"h-4 w-4 opacity-50"})})]})});I.displayName=O.xz.displayName;let V=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(O.u_,{ref:t,className:c("flex cursor-default items-center justify-center py-1",s),...l,children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})});V.displayName=O.u_.displayName;let D=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(O.$G,{ref:t,className:c("flex cursor-default items-center justify-center py-1",s),...l,children:(0,a.jsx)(T.Z,{className:"h-4 w-4"})})});D.displayName=O.$G.displayName;let P=l.forwardRef((e,t)=>{let{className:s,children:l,position:n="popper",...r}=e;return(0,a.jsx)(O.h_,{children:(0,a.jsxs)(O.VY,{ref:t,className:c("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...r,children:[(0,a.jsx)(V,{}),(0,a.jsx)(O.l_,{className:c("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,a.jsx)(D,{})]})})});P.displayName=O.VY.displayName,l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(O.__,{ref:t,className:c("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...l})}).displayName=O.__.displayName;let L=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(O.ck,{ref:t,className:c("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(O.wU,{children:(0,a.jsx)(Z.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(O.eT,{children:l})]})});function U(e){let{ready:t,setReady:s,selectedPhoneNumber:n,setSelectedPhoneNumber:r}=e,[i,o]=(0,l.useState)(!1),[c,d]=(0,l.useState)([]),[u,p]=(0,l.useState)(""),[x,f]=(0,l.useState)(""),[g,j]=(0,l.useState)(""),[N,b]=(0,l.useState)(!1),[O,T]=(0,l.useState)(!1),[E,Z]=(0,l.useState)(!1),[V,D]=(0,l.useState)(!1),[U,A]=(0,l.useState)(!1),F=g?"".concat(g,"/twiml"):"",W=F&&x&&F!==x;(0,l.useEffect)(()=>{let e=!0,t=async()=>{try{let e=await fetch("/api/twilio");if(!e.ok)throw Error("Failed credentials check");let t=await e.json();if(o(!!(null==t?void 0:t.credentialsSet)),!(e=await fetch("/api/twilio/numbers")).ok)throw Error("Failed to fetch phone numbers");let s=await e.json();if(Array.isArray(s)&&s.length>0){d(s);let e=s.find(e=>e.sid===u)||s[0];p(e.sid),f(e.voiceUrl||""),r(e.friendlyName||"")}let a="";try{let e=await fetch("".concat("https://illumination-engine-test.store/api","/public-url"));if(e.ok){let t=await e.json();a=(null==t?void 0:t.publicUrl)||"",b(!0),j(a)}else throw Error("Local server not responding")}catch(e){b(!1),j("")}}catch(e){console.error(e)}};t();let s=setInterval(()=>e&&t(),1e3);return()=>{e=!1,clearInterval(s)}},[u,r]);let Y=async()=>{if(u&&F)try{if(D(!0),!(await fetch("/api/twilio/numbers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumberSid:u,voiceUrl:F})})).ok)throw Error("Failed to update webhook");f(F)}catch(e){console.error(e)}finally{D(!1)}},q=async()=>{if(!N||!g)return;A(!0);let e=!1;for(let t=0;t<5;t++){try{if((await fetch(g+"/public-url")).ok){T(!0),e=!0;break}}catch(e){}t<4&&await new Promise(e=>setTimeout(e,3e3))}e||T(!1),A(!1)},G=(0,l.useMemo)(()=>[{label:"Set up Twilio account",done:!0,description:"Then update account details in webapp/.env",field:(0,a.jsx)(m,{className:"w-full",onClick:()=>window.open("https://console.twilio.com/","_blank"),children:"Open Twilio Console"})},{label:"Set up Twilio phone number",done:!0,description:"Costs around $1.15/month",field:c.length>0?1===c.length?(0,a.jsx)(k,{value:c[0].friendlyName||"",disabled:!0}):(0,a.jsxs)(J,{onValueChange:e=>{p(e);let t=c.find(t=>t.sid===e);t&&(r(t.friendlyName||""),f(t.voiceUrl||""))},value:u,children:[(0,a.jsx)(I,{className:"w-full",children:(0,a.jsx)(z,{placeholder:"Select a phone number"})}),(0,a.jsx)(P,{children:c.map(e=>(0,a.jsx)(L,{value:e.sid,children:e.friendlyName},e.sid))})]}):(0,a.jsx)(m,{className:"w-full",onClick:()=>window.open("https://console.twilio.com/us1/develop/phone-numbers/manage/incoming","_blank"),children:"Set up Twilio phone number"})},{label:"Start WebSocket server",done:!0,description:"WebSocket server running and accessible",field:null},{label:"Public URL accessible",done:!0,description:"Server accessible via public domain",field:(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(k,{value:g,disabled:!0})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(m,{variant:"outline",onClick:q,disabled:U||!N||!g,className:"w-full",children:U?(0,a.jsx)(_.Z,{className:"mr-2 h-4 animate-spin"}):"Check URL"})})]})},{label:"Update Twilio webhook URL",done:!0,description:"Can also be done manually in Twilio console",field:(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(k,{value:x,disabled:!0,className:"w-full"})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(m,{onClick:Y,disabled:V,className:"w-full",children:V?(0,a.jsx)(_.Z,{className:"mr-2 h-4 animate-spin"}):"Update Webhook"})})]})}],[i,c,u,N,g,O,x,W,F,V,U,r]);return(0,l.useEffect)(()=>{Z(G.every(e=>e.done))},[G]),(0,l.useEffect)(()=>{t||q()},[N,t]),(0,l.useEffect)(()=>{E||s(!1)},[E,s]),(0,a.jsx)(h,{open:!t,children:(0,a.jsxs)(v,{className:"w-full max-w-[800px]",children:[(0,a.jsxs)(y,{children:[(0,a.jsx)(w,{children:"Setup Checklist"}),(0,a.jsx)(S,{children:"This sample app requires a few steps before you get started"})]}),(0,a.jsx)("div",{className:"mt-4 space-y-0",children:G.map((e,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 py-2",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[e.done?(0,a.jsx)(C.Z,{className:"text-green-500"}):(0,a.jsx)(R.Z,{className:"text-gray-400"}),(0,a.jsx)("span",{className:"font-medium",children:e.label})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-500 ml-8",children:e.description})]}),(0,a.jsx)("div",{className:"flex items-center mt-2 sm:mt-0",children:e.field})]},t))}),(0,a.jsx)("div",{className:"mt-6 flex flex-col sm:flex-row sm:justify-end",children:(0,a.jsx)(m,{variant:"outline",onClick:()=>s(!0),disabled:!E,children:"Let's go!"})})]})})}L.displayName=O.ck.displayName,l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(O.Z0,{ref:t,className:c("-mx-1 my-1 h-px bg-muted",s),...l})}).displayName=O.Z0.displayName;let A=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{ref:t,className:c("rounded-lg border bg-card text-card-foreground shadow-sm",s),...l})});A.displayName="Card";let F=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{ref:t,className:c("flex flex-col space-y-1.5 p-6",s),...l})});F.displayName="CardHeader";let W=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("h3",{ref:t,className:c("text-2xl font-semibold leading-none tracking-tight",s),...l})});W.displayName="CardTitle",l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("p",{ref:t,className:c("text-sm text-muted-foreground",s),...l})}).displayName="CardDescription";let Y=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{ref:t,className:c("p-6 pt-0",s),...l})});Y.displayName="CardContent",l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{ref:t,className:c("flex items-center p-6 pt-0",s),...l})}).displayName="CardFooter";var q=s(153);let G=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(q.fC,{ref:t,className:c("relative overflow-hidden",s),...n,children:[(0,a.jsx)(q.l_,{className:"h-full w-full rounded-[inherit]",children:l}),(0,a.jsx)(H,{}),(0,a.jsx)(q.Ns,{})]})});G.displayName=q.fC.displayName;let H=l.forwardRef((e,t)=>{let{className:s,orientation:l="vertical",...n}=e;return(0,a.jsx)(q.gb,{ref:t,orientation:l,className:c("flex touch-none select-none transition-colors","vertical"===l&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:(0,a.jsx)(q.q4,{className:"relative flex-1 rounded-full bg-border"})})});H.displayName=q.gb.displayName;let $=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("textarea",{className:c("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l})});$.displayName="Textarea";var B=s(6780),M=s(6649),K=s(399),Q=s(2513);let X=[{name:"get_weather",type:"function",description:"Get the current weather",parameters:{type:"object",properties:{location:{type:"string"}}}},{name:"ping_no_args",type:"function",description:"A simple ping tool with no arguments",parameters:{type:"object",properties:{}}},{name:"get_user_nested_args",type:"function",description:"Fetch user profile by nested identifier",parameters:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},metadata:{type:"object",properties:{region:{type:"string"},role:{type:"string"}}}}}}}},{name:"calculate_route_more_properties",type:"function",description:"Calculate travel route with multiple parameters",parameters:{type:"object",properties:{start:{type:"string"},end:{type:"string"},mode:{type:"string",enum:["car","bike","walk"]},options:{type:"object",properties:{avoid_highways:{type:"boolean"},scenic_route:{type:"boolean"}}}}}},{name:"disconnect_call",type:"function",description:"Disconnect the active phone call and realtime session",parameters:{type:"object",properties:{reason:{type:"string"}}}},{name:"record_vehicle_experience",type:"function",description:"Record a vehicle purchase experience with rating and feedback",parameters:{type:"object",properties:{vehicle:{type:"string"},rating:{type:"number"},feedback:{type:"string"}},required:["vehicle","rating","feedback"]}}],ee=()=>(0,a.jsx)("span",{className:"ml-2 text-xs text-green-600 border border-green-600 rounded px-1 py-[1px]",children:"backend"}),et=e=>{let{open:t,onOpenChange:s,editingIndex:l,selectedTemplate:n,editingSchemaStr:r,isJsonValid:i,onTemplateChange:o,onSchemaChange:c,onSave:d,backendTools:u}=e,p=[...X.map(e=>({...e,source:"local"})),...u.map(e=>({...e,source:"backend"}))];return(0,a.jsx)(h,{open:t,onOpenChange:s,children:(0,a.jsxs)(v,{className:"sm:max-w-lg",children:[(0,a.jsx)(y,{children:(0,a.jsx)(w,{children:null===l?"Add Tool":"Edit Tool"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)(J,{value:n,onValueChange:o,children:[(0,a.jsx)(I,{children:(0,a.jsx)(z,{placeholder:"Select a template (optional)"})}),(0,a.jsx)(P,{children:p.map(e=>(0,a.jsx)(L,{value:e.name,children:(0,a.jsxs)("span",{className:"flex items-center",children:[e.name,"backend"===e.source&&(0,a.jsx)(ee,{})]})},e.name))})]}),(0,a.jsx)($,{className:"min-h-[200px] font-mono text-sm",value:r,onChange:e=>c(e.target.value),placeholder:"Enter tool JSON schema"})]}),(0,a.jsxs)(b,{children:[(0,a.jsx)(m,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,a.jsx)(m,{onClick:d,disabled:!i,children:"Save Changes"})]})]})})};var es=e=>{let{callStatus:t,onSave:s}=e,[n,r]=(0,l.useState)("You are a helpful assistant in a phone call."),[i,o]=(0,l.useState)("ash"),[c,d]=(0,l.useState)([]),[u,p]=(0,l.useState)(null),[x,f]=(0,l.useState)(""),[h,g]=(0,l.useState)(!0),[j,N]=(0,l.useState)(!1),[v,y]=(0,l.useState)(""),[b,w]=(0,l.useState)("idle"),[S,k]=(0,l.useState)(!1),_=function(e,t){let[s,a]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let t=!0,s=()=>{fetch(e).then(e=>e.json()).then(e=>{t&&a(e)}).catch(e=>{console.error("Error fetching backend tools:",e)})};s();let l=setInterval(s,3e3);return()=>{t=!1,clearInterval(l)}},[e,3e3]),s}("".concat("https://illumination-engine-test.store/api","/tools"),0);(0,l.useEffect)(()=>{k(!0)},[n,i,c]),(0,l.useEffect)(()=>{if("saved"===b){let e=setTimeout(()=>{w("idle")},3e3);return()=>clearTimeout(e)}},[b]);let C=async()=>{w("saving");try{await s({instructions:n,voice:i,tools:c.map(e=>JSON.parse(e))}),w("saved"),k(!1)}catch(e){w("error")}},R=e=>{p(e),f(c[e]||""),y(""),g(!0),N(!0)},O=e=>{let t=[...c];t.splice(e,1),d(t)},T=e=>{try{let t=JSON.parse(e);return(null==t?void 0:t.name)||"Untitled Tool"}catch(e){return"Invalid JSON"}},E=e=>_.some(t=>t.name===e);return(0,a.jsxs)(A,{className:"flex flex-col h-full w-full mx-auto",children:[(0,a.jsx)(F,{className:"pb-0 px-4 sm:px-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(W,{className:"text-base font-semibold",children:"Session Configuration"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:"error"===b?(0,a.jsxs)("span",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,a.jsx)(B.Z,{className:"h-3 w-3"}),"Save failed"]}):S?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Not saved"}):(0,a.jsxs)("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)(Z.Z,{className:"h-3 w-3"}),"Saved"]})})]})}),(0,a.jsx)(Y,{className:"flex-1 p-3 sm:p-5",children:(0,a.jsx)(G,{className:"h-full",children:(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6 m-1",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium leading-none",children:"Instructions"}),(0,a.jsx)($,{placeholder:"Enter instructions",className:"min-h-[100px] resize-none",value:n,onChange:e=>r(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium leading-none",children:"Voice"}),(0,a.jsxs)(J,{value:i,onValueChange:o,children:[(0,a.jsx)(I,{className:"w-full",children:(0,a.jsx)(z,{placeholder:"Select voice"})}),(0,a.jsx)(P,{children:["ash","ballad","coral","sage","verse"].map(e=>(0,a.jsx)(L,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium leading-none",children:"Tools"}),(0,a.jsxs)("div",{className:"space-y-2",children:[c.map((e,t)=>{let s=T(e),l=E(s);return(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-2 sm:p-3 gap-2",children:[(0,a.jsxs)("span",{className:"text-sm truncate flex-1 min-w-0 flex items-center",children:[s,l&&(0,a.jsx)(ee,{})]}),(0,a.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[(0,a.jsx)(m,{variant:"ghost",size:"icon",onClick:()=>R(t),className:"h-8 w-8",children:(0,a.jsx)(M.Z,{className:"h-4 w-4"})}),(0,a.jsx)(m,{variant:"ghost",size:"icon",onClick:()=>O(t),className:"h-8 w-8",children:(0,a.jsx)(K.Z,{className:"h-4 w-4"})})]})]},t)}),(0,a.jsxs)(m,{variant:"outline",className:"w-full",onClick:()=>{p(null),f(""),y(""),g(!0),N(!0)},children:[(0,a.jsx)(Q.Z,{className:"h-4 w-4 mr-2"}),"Add Tool"]})]})]}),(0,a.jsx)(m,{className:"w-full mt-4",onClick:C,disabled:"saving"===b||!S,children:"saving"===b?"Saving...":"saved"===b?(0,a.jsxs)("span",{className:"flex items-center",children:["Saved Successfully",(0,a.jsx)(Z.Z,{className:"ml-2 h-4 w-4"})]}):"error"===b?"Error Saving":"Save Configuration"})]})})}),(0,a.jsx)(et,{open:j,onOpenChange:N,editingIndex:u,selectedTemplate:v,editingSchemaStr:x,isJsonValid:h,onTemplateChange:e=>{y(e);let t=X.find(t=>t.name===e)||_.find(t=>t.name===e);t&&(f(JSON.stringify(t,null,2)),g(!0))},onSchemaChange:e=>{f(e);try{JSON.parse(e),g(!0)}catch(e){g(!1)}},onSave:()=>{try{JSON.parse(x)}catch(e){return}let e=[...c];null===u?e.push(x):e[u]=x,d(e),N(!1)},backendTools:_})]})},ea=s(7390),el=s(9832),en=s(3045),er=s(8954),ei=e=>{let{items:t}=e,s=(0,l.useRef)(null);(0,l.useEffect)(()=>{var e;null===(e=s.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]);let n=t.filter(e=>"message"===e.type||"function_call"===e.type||"function_call_output"===e.type);return(0,a.jsx)(A,{className:"h-full flex flex-col overflow-hidden",children:(0,a.jsxs)(Y,{className:"flex-1 h-full min-h-0 overflow-hidden flex flex-col p-0",children:[0===n.length&&(0,a.jsx)("div",{className:"flex flex-1 h-full items-center justify-center mt-36",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3 justify-center h-full",children:[(0,a.jsx)("div",{className:"h-[140px] w-[140px] rounded-full bg-secondary/20 flex items-center justify-center",children:(0,a.jsx)(ea.Z,{className:"h-16 w-16 text-foreground/10 bg-transparent"})}),(0,a.jsxs)("div",{className:"text-center space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-foreground/60",children:"No messages yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Start a call to see the transcript"})]})]})}),(0,a.jsx)(G,{className:"h-full",children:(0,a.jsxs)("div",{className:"flex flex-col gap-6 p-6",children:[n.map((e,t)=>{let s="user"===e.role,l="tool"===e.role,n=s?el.Z:l?en.Z:er.Z,r=e.content?e.content.map(e=>e.text).join(""):"";return(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"shrink-0 w-8 h-8 rounded-full flex items-center justify-center border ".concat(s?"bg-background border-border":"bg-secondary border-secondary"),children:(0,a.jsx)(n,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,a.jsx)("span",{className:"text-sm font-medium ".concat(s?"text-muted-foreground":"text-foreground"),children:s?"Caller":l?"Tool Response":"Assistant"}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:e.timestamp})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed break-words",children:r})]})]},t)}),(0,a.jsx)("div",{ref:s})]})})]})})};let eo=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ec(e){let{className:t,variant:s,...l}=e;return(0,a.jsx)("div",{className:c(eo({variant:s}),t),...l})}var ed=e=>{let{items:t,ws:s}=e,[n,r]=(0,l.useState)({}),[i,o]=(0,l.useState)([]);l.useEffect(()=>{function e(){try{let e=window.localStorage.getItem("vehicle_experience_ratings");e&&o(JSON.parse(e))}catch(e){}}e();let t=()=>e();return window.addEventListener("vehicle-experience-updated",t),()=>window.removeEventListener("vehicle-experience-updated",t)},[]);let c=t.filter(e=>"function_call"===e.type).map(e=>{let s=t.filter(t=>"function_call_output"===t.type&&t.call_id===e.call_id)[0],a="completed"===e.status||!!s,l=s?s.output:void 0;return{...e,completed:a,response:l}}),d=(e,t)=>{r(s=>({...s,[e]:t}))},u=e=>{if(!s||s.readyState!==WebSocket.OPEN)return;let t=e.call_id||"";s.send(JSON.stringify({type:"conversation.item.create",item:{type:"function_call_output",call_id:t,output:JSON.stringify(n[t]||"")}})),s.send(JSON.stringify({type:"response.create"}))};return(0,a.jsxs)(A,{className:"flex flex-col h-full relative",children:[(0,a.jsx)(F,{className:"space-y-1.5 pb-0",children:(0,a.jsx)(W,{className:"text-base font-semibold",children:"Function Calls"})}),(0,a.jsxs)(Y,{className:"flex-1 p-4",children:[(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsxs)(h,{children:[(0,a.jsx)(g,{asChild:!0,children:(0,a.jsx)(m,{size:"sm",variant:"outline",children:"Ratings"})}),(0,a.jsxs)(v,{className:"max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)(y,{children:(0,a.jsx)(w,{children:"Vehicle Experience Ratings"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[0===i.length&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"No ratings captured yet."}),i.map((e,t)=>(0,a.jsxs)("div",{className:"rounded-md border p-3 text-sm space-y-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.vehicle}),(0,a.jsxs)("div",{className:"flex text-xs gap-2",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Rating:"}),(0,a.jsx)("span",{children:e.rating}),(0,a.jsx)("span",{className:"font-semibold",children:"Time:"}),(0,a.jsx)("span",{children:new Date(e.serverTimestamp||Date.now()).toLocaleString()})]}),(0,a.jsx)("div",{className:"text-muted-foreground whitespace-pre-wrap break-words",children:e.feedback})]},t))]})]})]})}),(0,a.jsx)(G,{className:"h-full",children:(0,a.jsx)("div",{className:"space-y-4",children:c.map(e=>(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)(ec,{variant:e.completed?"default":"secondary",children:e.completed?"Completed":"Pending"})]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground font-mono break-all",children:JSON.stringify(e.params)}),e.completed?(0,a.jsx)("div",{className:"text-sm rounded-md bg-muted p-3",children:JSON.stringify(JSON.parse(e.response||""))}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k,{placeholder:"Enter response",value:n[e.call_id||""]||"",onChange:t=>d(e.call_id||"",t.target.value)}),(0,a.jsx)(m,{variant:"outline",size:"sm",onClick:()=>u(e),disabled:!n[e.call_id||""],className:"w-full",children:"Submit Response"})]})]},e.id))})})]})]})},em=s(5733),eu=s(7019),ep=e=>{let{selectedPhoneNumber:t,allConfigsReady:s,setAllConfigsReady:n}=e,[r,i]=(0,l.useState)(!0),[o,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(!1),[p,x]=(0,l.useState)(null),[f,h]=(0,l.useState)(null),g=!!o&&s&&!d,j=async()=>{if(g){u(!0),x(null),h(null);try{let e=await fetch("/api/twilio/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:o.trim()})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"HTTP ".concat(e.status))}let t=await e.json();x(t.sid||null)}catch(e){h(e.message||"Failed to start call")}finally{u(!1)}}};return(0,a.jsxs)(A,{className:"flex flex-col gap-3 p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Number"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"font-medium w-36",children:r?t||"None":"••••••••••"}),(0,a.jsx)(m,{variant:"ghost",size:"icon",onClick:()=>i(!r),className:"h-8 w-8",children:r?(0,a.jsx)(em.Z,{className:"h-4 w-4"}):(0,a.jsx)(eu.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s?(0,a.jsx)(C.Z,{className:"text-green-500 w-4 h-4"}):(0,a.jsx)(R.Z,{className:"text-gray-400 w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:s?"Setup Ready":"Setup Not Ready"})]}),(0,a.jsx)(m,{variant:"outline",size:"sm",onClick:()=>n(!1),children:"Checklist"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Dial Destination"}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(k,{placeholder:"+15551234567",value:o,onChange:e=>c(e.target.value),className:"flex-1"}),(0,a.jsxs)(m,{size:"sm",onClick:j,disabled:!g,className:"flex items-center gap-1",children:[d?(0,a.jsx)(_.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(el.Z,{className:"h-4 w-4"}),d?"Calling...":"Call"]})]}),(0,a.jsxs)("div",{className:"min-h-[18px] text-xs",children:[p&&(0,a.jsxs)("span",{className:"text-green-600",children:["Started call SID: ",p]}),f&&(0,a.jsx)("span",{className:"text-red-600",children:f})]}),!s&&(0,a.jsx)("p",{className:"text-[11px] text-gray-500",children:"Complete setup before placing a call."})]})]})},ex=()=>{let[e,t]=(0,l.useState)(""),[s,n]=(0,l.useState)(!1),[r,i]=(0,l.useState)([]),[o,c]=(0,l.useState)("disconnected"),[d,m]=(0,l.useState)(null);return(0,l.useEffect)(()=>{if(s&&!d){let e=new WebSocket("".concat("https://illumination-engine-test.store/api","/logs"));e.onopen=()=>{console.log("Connected to logs websocket"),c("connected")},e.onmessage=e=>{let t=JSON.parse(e.data);console.log("Received logs event:",t),function(e,t){function s(e){return{object:"realtime.item",timestamp:new Date().toLocaleTimeString(),...e}}let{type:a}=e;switch(a){case"session.created":t([]);break;case"input_audio_buffer.speech_started":{let{item_id:a}=e;t(e=>[...e,s({id:a,type:"message",role:"user",content:[{type:"text",text:"..."}],status:"running"})]);break}case"conversation.item.created":{let{item:a}=e;if("message"===a.type){let e=a.content&&a.content.length>0?a.content:[];t(t=>{let l=t.findIndex(e=>e.id===a.id);if(!(l>=0))return[...t,s({...a,content:e,status:"completed"})];{let s=[...t];return s[l]={...s[l],...a,content:e,status:"completed",timestamp:s[l].timestamp||new Date().toLocaleTimeString()},s}})}else if("function_call_output"===a.type){t(e=>[...e,s({...a,role:"tool",content:[{type:"text",text:"Function call response: ".concat(a.output)}],status:"completed"})].map(e=>e.call_id===a.call_id&&"function_call"===e.type?{...e,status:"completed"}:e));try{let e=JSON.parse(a.output||"{}");if(e&&e.vehicle&&e.rating&&e.feedback){let t="vehicle_experience_ratings",s=window.localStorage.getItem(t),a=s?JSON.parse(s):[];a.push(e),window.localStorage.setItem(t,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("vehicle-experience-updated",{detail:e}))}}catch(e){}}break}case"conversation.item.input_audio_transcription.completed":{let{item_id:s,transcript:a}=e;t(e=>e.map(e=>e.id===s&&"message"===e.type&&"user"===e.role?{...e,content:[{type:"text",text:a}],status:"completed"}:e));break}case"response.content_part.added":{let{item_id:a,part:l,output_index:n}=e;"text"===l.type&&0===n&&t(e=>{let t=e.findIndex(e=>e.id===a);if(!(t>=0))return[...e,s({id:a,type:"message",role:"assistant",content:[{type:l.type,text:l.text}],status:"running"})];{let s=[...e],a=s[t].content||[];return s[t]={...s[t],content:[...a,{type:l.type,text:l.text}]},s}});break}case"response.audio_transcript.delta":{let{item_id:a,delta:l,output_index:n}=e;0===n&&l&&t(e=>{let t=e.findIndex(e=>e.id===a);if(!(t>=0))return[...e,s({id:a,type:"message",role:"assistant",content:[{type:"text",text:l}],status:"running"})];{let s=[...e],a=s[t].content||[];return s[t]={...s[t],content:[...a,{type:"text",text:l}]},s}});break}case"response.output_item.done":{let{item:a}=e;"function_call"===a.type&&(console.log("function_call",a),t(e=>[...e,s({...a,role:"assistant",content:[{type:"text",text:"".concat(a.name,"(").concat(JSON.stringify(JSON.parse(a.arguments)),")")}],status:"running"})]))}}}(t,i)},e.onclose=()=>{console.log("Logs websocket disconnected"),m(null),c("disconnected")},m(e)}},[s,d]),(0,a.jsxs)("div",{className:"h-screen bg-white flex flex-col",children:[(0,a.jsx)(U,{ready:s,setReady:n,selectedPhoneNumber:e,setSelectedPhoneNumber:t}),(0,a.jsx)(x,{}),(0,a.jsx)("div",{className:"flex-grow p-4 h-full overflow-hidden flex flex-col",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 h-full",children:[(0,a.jsx)("div",{className:"col-span-3 flex flex-col h-full overflow-hidden",children:(0,a.jsx)(es,{callStatus:o,onSave:e=>{if(d&&d.readyState===WebSocket.OPEN){let t={type:"session.update",session:{...e}};console.log("Sending update event:",t),d.send(JSON.stringify(t))}}})}),(0,a.jsxs)("div",{className:"col-span-6 flex flex-col gap-4 h-full overflow-hidden",children:[(0,a.jsx)(ep,{selectedPhoneNumber:e,allConfigsReady:s,setAllConfigsReady:n}),(0,a.jsx)(ei,{items:r})]}),(0,a.jsx)("div",{className:"col-span-3 flex flex-col h-full overflow-hidden",children:(0,a.jsx)(ed,{items:r,ws:d})})]})})]})}}},function(e){e.O(0,[9,971,23,744],function(){return e(e.s=802)}),_N_E=e.O()}]);