(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{802:function(e,t,s){Promise.resolve().then(s.bind(s,3237))},3237:function(e,t,s){"use strict";s.d(t,{default:function(){return ep}});var a=s(7437),l=s(2265),n=()=>(0,a.jsx)("div",{className:"flex justify-between items-center px-6 py-4 border-b",children:(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"Call Assistant"})})}),i=s(8137),r=s(4839),o=s(6164);function c(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,o.m6)((0,r.W)(t))}let d=i.fC,u=i.xz,m=i.h_;i.x8;let p=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.aV,{ref:t,className:c("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...l})});p.displayName=i.aV.displayName;let f=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(m,{children:[(0,a.jsx)(p,{}),(0,a.jsx)(i.VY,{ref:t,className:c("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:l})]})});f.displayName=i.VY.displayName;let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:c("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};x.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:c("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let g=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.Dx,{ref:t,className:c("text-lg font-semibold leading-none tracking-tight",s),...l})});g.displayName=i.Dx.displayName;let v=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(i.dk,{ref:t,className:c("text-sm text-muted-foreground",s),...l})});v.displayName=i.dk.displayName;let j=l.forwardRef((e,t)=>{let{className:s,type:l,...n}=e;return(0,a.jsx)("input",{type:l,className:c("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...n})});j.displayName="Input";var y=s(1538),b=s(2218);let N=(0,b.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),w=l.forwardRef((e,t)=>{let{className:s,variant:l,size:n,asChild:i=!1,...r}=e,o=i?y.g7:"button";return(0,a.jsx)(o,{className:c(N({variant:l,size:n,className:s})),ref:t,...r})});w.displayName="Button";var S=s(3274),k=s(2940),C=s(8165),_=s(1848),E=s(2421),R=s(4392),T=s(2468);let O=_.fC;_.ZA;let Z=_.B4,J=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(_.xz,{ref:t,className:c("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[l,(0,a.jsx)(_.JO,{asChild:!0,children:(0,a.jsx)(E.Z,{className:"h-4 w-4 opacity-50"})})]})});J.displayName=_.xz.displayName;let z=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(_.u_,{ref:t,className:c("flex cursor-default items-center justify-center py-1",s),...l,children:(0,a.jsx)(R.Z,{className:"h-4 w-4"})})});z.displayName=_.u_.displayName;let D=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(_.$G,{ref:t,className:c("flex cursor-default items-center justify-center py-1",s),...l,children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})});D.displayName=_.$G.displayName;let I=l.forwardRef((e,t)=>{let{className:s,children:l,position:n="popper",...i}=e;return(0,a.jsx)(_.h_,{children:(0,a.jsxs)(_.VY,{ref:t,className:c("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...i,children:[(0,a.jsx)(z,{}),(0,a.jsx)(_.l_,{className:c("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,a.jsx)(D,{})]})})});I.displayName=_.VY.displayName,l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(_.__,{ref:t,className:c("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...l})}).displayName=_.__.displayName;let V=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(_.ck,{ref:t,className:c("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(_.wU,{children:(0,a.jsx)(T.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(_.eT,{children:l})]})});function Y(e){let{ready:t,setReady:s,selectedPhoneNumber:n,setSelectedPhoneNumber:i}=e,[r,o]=(0,l.useState)(!1),[c,u]=(0,l.useState)([]),[m,p]=(0,l.useState)(""),[h,y]=(0,l.useState)(""),[b,N]=(0,l.useState)(""),[_,E]=(0,l.useState)(!1),[R,T]=(0,l.useState)(!1),[z,D]=(0,l.useState)(!1),[Y,A]=(0,l.useState)(!1),[P,L]=(0,l.useState)(!1),U=b?"".concat(b,"/twiml"):"",F=U&&h&&U!==h;(0,l.useEffect)(()=>{let e=!0,t=async()=>{try{let e=await fetch("/api/twilio");if(!e.ok)throw Error("Failed credentials check");let t=await e.json();if(o(!!(null==t?void 0:t.credentialsSet)),!(e=await fetch("/api/twilio/numbers")).ok)throw Error("Failed to fetch phone numbers");let s=await e.json();if(Array.isArray(s)&&s.length>0){u(s);let e=s.find(e=>e.sid===m)||s[0];p(e.sid),y(e.voiceUrl||""),i(e.friendlyName||"")}let a="";try{let e=await fetch("".concat("https://illumination-engine-test.store/api","/public-url"));if(e.ok){let t=await e.json();a=(null==t?void 0:t.publicUrl)||"",E(!0),N(a)}else throw Error("Local server not responding")}catch(e){E(!1),N("")}}catch(e){console.error(e)}};t();let s=setInterval(()=>e&&t(),1e3);return()=>{e=!1,clearInterval(s)}},[m,i]);let W=async()=>{if(m&&U)try{if(A(!0),!(await fetch("/api/twilio/numbers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumberSid:m,voiceUrl:U})})).ok)throw Error("Failed to update webhook");y(U)}catch(e){console.error(e)}finally{A(!1)}},q=async()=>{if(!_||!b)return;L(!0);let e=!1;for(let t=0;t<5;t++){try{if((await fetch(b+"/public-url")).ok){T(!0),e=!0;break}}catch(e){}t<4&&await new Promise(e=>setTimeout(e,3e3))}e||T(!1),L(!1)},B=(0,l.useMemo)(()=>[{label:"Set up Twilio account",done:!0,description:"Then update account details in webapp/.env",field:(0,a.jsx)(w,{className:"w-full",onClick:()=>window.open("https://console.twilio.com/","_blank"),children:"Open Twilio Console"})},{label:"Set up Twilio phone number",done:!0,description:"Costs around $1.15/month",field:c.length>0?1===c.length?(0,a.jsx)(j,{value:c[0].friendlyName||"",disabled:!0}):(0,a.jsxs)(O,{onValueChange:e=>{p(e);let t=c.find(t=>t.sid===e);t&&(i(t.friendlyName||""),y(t.voiceUrl||""))},value:m,children:[(0,a.jsx)(J,{className:"w-full",children:(0,a.jsx)(Z,{placeholder:"Select a phone number"})}),(0,a.jsx)(I,{children:c.map(e=>(0,a.jsx)(V,{value:e.sid,children:e.friendlyName},e.sid))})]}):(0,a.jsx)(w,{className:"w-full",onClick:()=>window.open("https://console.twilio.com/us1/develop/phone-numbers/manage/incoming","_blank"),children:"Set up Twilio phone number"})},{label:"Start WebSocket server",done:!0,description:"WebSocket server running and accessible",field:null},{label:"Public URL accessible",done:!0,description:"Server accessible via public domain",field:(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(j,{value:b,disabled:!0})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(w,{variant:"outline",onClick:q,disabled:P||!_||!b,className:"w-full",children:P?(0,a.jsx)(S.Z,{className:"mr-2 h-4 animate-spin"}):"Check URL"})})]})},{label:"Update Twilio webhook URL",done:!0,description:"Can also be done manually in Twilio console",field:(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(j,{value:h,disabled:!0,className:"w-full"})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(w,{onClick:W,disabled:Y,className:"w-full",children:Y?(0,a.jsx)(S.Z,{className:"mr-2 h-4 animate-spin"}):"Update Webhook"})})]})}],[r,c,m,_,b,R,h,F,U,Y,P,i]);return(0,l.useEffect)(()=>{D(B.every(e=>e.done))},[B]),(0,l.useEffect)(()=>{t||q()},[_,t]),(0,l.useEffect)(()=>{z||s(!1)},[z,s]),(0,a.jsx)(d,{open:!t,children:(0,a.jsxs)(f,{className:"w-full max-w-[800px]",children:[(0,a.jsxs)(x,{children:[(0,a.jsx)(g,{children:"Setup Checklist"}),(0,a.jsx)(v,{children:"This sample app requires a few steps before you get started"})]}),(0,a.jsx)("div",{className:"mt-4 space-y-0",children:B.map((e,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 py-2",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[e.done?(0,a.jsx)(k.Z,{className:"text-green-500"}):(0,a.jsx)(C.Z,{className:"text-gray-400"}),(0,a.jsx)("span",{className:"font-medium",children:e.label})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-500 ml-8",children:e.description})]}),(0,a.jsx)("div",{className:"flex items-center mt-2 sm:mt-0",children:e.field})]},t))}),(0,a.jsx)("div",{className:"mt-6 flex flex-col sm:flex-row sm:justify-end",children:(0,a.jsx)(w,{variant:"outline",onClick:()=>s(!0),disabled:!z,children:"Let's go!"})})]})})}V.displayName=_.ck.displayName,l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(_.Z0,{ref:t,className:c("-mx-1 my-1 h-px bg-muted",s),...l})}).displayName=_.Z0.displayName;let A=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{ref:t,className:c("rounded-lg border bg-card text-card-foreground shadow-sm",s),...l})});A.displayName="Card";let P=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{ref:t,className:c("flex flex-col space-y-1.5 p-6",s),...l})});P.displayName="CardHeader";let L=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("h3",{ref:t,className:c("text-2xl font-semibold leading-none tracking-tight",s),...l})});L.displayName="CardTitle",l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("p",{ref:t,className:c("text-sm text-muted-foreground",s),...l})}).displayName="CardDescription";let U=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{ref:t,className:c("p-6 pt-0",s),...l})});U.displayName="CardContent",l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("div",{ref:t,className:c("flex items-center p-6 pt-0",s),...l})}).displayName="CardFooter";var F=s(153);let W=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(F.fC,{ref:t,className:c("relative overflow-hidden",s),...n,children:[(0,a.jsx)(F.l_,{className:"h-full w-full rounded-[inherit]",children:l}),(0,a.jsx)(q,{}),(0,a.jsx)(F.Ns,{})]})});W.displayName=F.fC.displayName;let q=l.forwardRef((e,t)=>{let{className:s,orientation:l="vertical",...n}=e;return(0,a.jsx)(F.gb,{ref:t,orientation:l,className:c("flex touch-none select-none transition-colors","vertical"===l&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:(0,a.jsx)(F.q4,{className:"relative flex-1 rounded-full bg-border"})})});q.displayName=F.gb.displayName;let B=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("textarea",{className:c("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l})});B.displayName="Textarea";var H=s(6780),G=s(6649),$=s(399),M=s(2513);let K=[{name:"get_weather",type:"function",description:"Get the current weather",parameters:{type:"object",properties:{location:{type:"string"}}}},{name:"ping_no_args",type:"function",description:"A simple ping tool with no arguments",parameters:{type:"object",properties:{}}},{name:"get_user_nested_args",type:"function",description:"Fetch user profile by nested identifier",parameters:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},metadata:{type:"object",properties:{region:{type:"string"},role:{type:"string"}}}}}}}},{name:"calculate_route_more_properties",type:"function",description:"Calculate travel route with multiple parameters",parameters:{type:"object",properties:{start:{type:"string"},end:{type:"string"},mode:{type:"string",enum:["car","bike","walk"]},options:{type:"object",properties:{avoid_highways:{type:"boolean"},scenic_route:{type:"boolean"}}}}}},{name:"disconnect_call",type:"function",description:"Disconnect the active phone call and realtime session",parameters:{type:"object",properties:{reason:{type:"string"}}}},{name:"record_vehicle_experience",type:"function",description:"Record a vehicle purchase experience with rating and feedback",parameters:{type:"object",properties:{vehicle:{type:"string"},rating:{type:"number"},feedback:{type:"string"}},required:["vehicle","rating","feedback"]}}],Q=()=>(0,a.jsx)("span",{className:"ml-2 text-xs text-green-600 border border-green-600 rounded px-1 py-[1px]",children:"backend"}),X=e=>{let{open:t,onOpenChange:s,editingIndex:l,selectedTemplate:n,editingSchemaStr:i,isJsonValid:r,onTemplateChange:o,onSchemaChange:c,onSave:u,backendTools:m}=e,p=[...K.map(e=>({...e,source:"local"})),...m.map(e=>({...e,source:"backend"}))];return(0,a.jsx)(d,{open:t,onOpenChange:s,children:(0,a.jsxs)(f,{className:"sm:max-w-lg",children:[(0,a.jsx)(x,{children:(0,a.jsx)(g,{children:null===l?"Add Tool":"Edit Tool"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)(O,{value:n,onValueChange:o,children:[(0,a.jsx)(J,{children:(0,a.jsx)(Z,{placeholder:"Select a template (optional)"})}),(0,a.jsx)(I,{children:p.map(e=>(0,a.jsx)(V,{value:e.name,children:(0,a.jsxs)("span",{className:"flex items-center",children:[e.name,"backend"===e.source&&(0,a.jsx)(Q,{})]})},e.name))})]}),(0,a.jsx)(B,{className:"min-h-[200px] font-mono text-sm",value:i,onChange:e=>c(e.target.value),placeholder:"Enter tool JSON schema"})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(w,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,a.jsx)(w,{onClick:u,disabled:!r,children:"Save Changes"})]})]})})},ee=[{label:"Survey Collection",value:"survey",instructions:"You are conducting a survey about community needs and social issues. Ask thoughtful questions to gather opinions and feedback. Be respectful and empathetic when discussing sensitive topics. Ensure you collect demographic information if relevant, and thank participants for their time and valuable input."},{label:"Environmental Awareness",value:"environment",instructions:"You are an environmental advocate raising awareness about climate change and sustainability. Discuss topics like renewable energy, waste reduction, conservation practices, and how individuals can make a positive environmental impact. Provide practical tips and inspire action while being informative and encouraging."},{label:"Mental Health Support",value:"mental_health",instructions:"You are providing mental health awareness and support information. Listen actively, show empathy, and provide resources for mental health services. Always emphasize that professional help should be sought for serious issues. Focus on destigmatizing mental health conversations and promoting well-being."},{label:"Community Outreach",value:"community",instructions:"You are reaching out to community members to discuss local issues, events, and opportunities for civic engagement. Encourage participation in community activities, volunteer work, and local governance. Be friendly, inclusive, and focus on building stronger community connections."},{label:"Educational Support",value:"education",instructions:"You are promoting educational opportunities and literacy programs in the community. Discuss available resources, scholarships, tutoring programs, and adult education options. Encourage lifelong learning and help identify barriers to education that need to be addressed."},{label:"Healthcare Access",value:"healthcare",instructions:"You are discussing healthcare access and public health initiatives. Provide information about available health services, preventive care, health insurance options, and community health programs. Be sensitive to health concerns and emphasize the importance of regular medical care."},{label:"Poverty Alleviation",value:"poverty",instructions:"You are working on poverty alleviation initiatives and discussing economic empowerment. Talk about job training programs, financial literacy, food assistance, housing support, and other resources available to those in need. Be compassionate and non-judgmental while providing practical help."},{label:"Social Justice & Equality",value:"justice",instructions:"You are advocating for social justice and equality. Discuss issues related to discrimination, civil rights, fair treatment, and equal opportunities. Listen to concerns about injustice, provide information about legal resources, and promote understanding across different communities while encouraging peaceful advocacy."},{label:"Youth Development",value:"youth",instructions:"You are focused on youth development and empowerment programs. Discuss mentorship opportunities, after-school programs, career guidance, leadership development, and recreational activities for young people. Encourage youth engagement in positive activities and help them identify their potential and goals."},{label:"Senior Care & Support",value:"seniors",instructions:"You are providing support and resources for senior citizens. Discuss healthcare services for elderly, social programs, transportation assistance, housing options, and ways to combat social isolation among seniors. Show respect for their experience and wisdom while addressing their specific needs and concerns."}];var et=e=>{let{callStatus:t,onSave:s}=e,[n,i]=(0,l.useState)("You are a helpful assistant in a phone call."),[r,o]=(0,l.useState)("custom"),[c,d]=(0,l.useState)("ash"),[u,m]=(0,l.useState)([]),[p,f]=(0,l.useState)(null),[x,h]=(0,l.useState)(""),[g,v]=(0,l.useState)(!0),[j,y]=(0,l.useState)(!1),[b,N]=(0,l.useState)(""),[S,k]=(0,l.useState)("idle"),[C,_]=(0,l.useState)(!1),E=function(e,t){let[s,a]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let t=!0,s=()=>{fetch(e).then(e=>e.json()).then(e=>{t&&a(e)}).catch(e=>{console.error("Error fetching backend tools:",e)})};s();let l=setInterval(s,3e3);return()=>{t=!1,clearInterval(l)}},[e,3e3]),s}("".concat("https://illumination-engine-test.store/api","/tools"),0);(0,l.useEffect)(()=>{_(!0)},[n,c,u,r]),(0,l.useEffect)(()=>{if("saved"===S){let e=setTimeout(()=>{k("idle")},3e3);return()=>clearTimeout(e)}},[S]);let R=async()=>{k("saving");try{let e=await s({instructions:n,voice:c,tools:u.map(e=>JSON.parse(e))});if(!1===e){k("error");return}k("saved"),_(!1)}catch(e){k("error")}},z=e=>{f(e),h(u[e]||""),N(""),v(!0),y(!0)},D=e=>{let t=[...u];t.splice(e,1),m(t)},Y=e=>{try{let t=JSON.parse(e);return(null==t?void 0:t.name)||"Untitled Tool"}catch(e){return"Invalid JSON"}},F=e=>E.some(t=>t.name===e);return(0,a.jsxs)(A,{className:"flex flex-col h-full w-full mx-auto",children:[(0,a.jsx)(P,{className:"pb-0 px-4 sm:px-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(L,{className:"text-base font-semibold",children:"Call Configuration"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:"error"===S?(0,a.jsxs)("span",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,a.jsx)(H.Z,{className:"h-3 w-3"}),"Save failed"]}):C?(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Not saved"}):(0,a.jsxs)("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)(T.Z,{className:"h-3 w-3"}),"Saved"]})})]})}),(0,a.jsx)(U,{className:"flex-1 p-3 sm:p-5",children:(0,a.jsx)(W,{className:"h-full",children:(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6 m-1",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium leading-none",children:"Social Cause Templates"}),(0,a.jsxs)(O,{value:r,onValueChange:e=>{if(o(e),e&&"custom"!==e){let t=ee.find(t=>t.value===e);t&&i(t.instructions)}},children:[(0,a.jsx)(J,{className:"w-full",children:(0,a.jsx)(Z,{placeholder:"Select a social cause to auto-fill instructions"})}),(0,a.jsxs)(I,{children:[(0,a.jsx)(V,{value:"custom",children:"Custom Instructions"}),ee.map(e=>(0,a.jsx)(V,{value:e.value,children:e.label},e.value))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium leading-none",children:"Instructions"}),(0,a.jsx)(B,{placeholder:"Enter instructions",className:"min-h-[100px] resize-none",value:n,onChange:e=>i(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium leading-none",children:"Voice"}),(0,a.jsxs)(O,{value:c,onValueChange:d,children:[(0,a.jsx)(J,{className:"w-full",children:(0,a.jsx)(Z,{placeholder:"Select voice"})}),(0,a.jsx)(I,{children:["ash","ballad","coral","sage","verse"].map(e=>(0,a.jsx)(V,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium leading-none",children:"Tools"}),(0,a.jsxs)("div",{className:"space-y-2",children:[u.map((e,t)=>{let s=Y(e),l=F(s);return(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-2 sm:p-3 gap-2",children:[(0,a.jsxs)("span",{className:"text-sm truncate flex-1 min-w-0 flex items-center",children:[s,l&&(0,a.jsx)(Q,{})]}),(0,a.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[(0,a.jsx)(w,{variant:"ghost",size:"icon",onClick:()=>z(t),className:"h-8 w-8",children:(0,a.jsx)(G.Z,{className:"h-4 w-4"})}),(0,a.jsx)(w,{variant:"ghost",size:"icon",onClick:()=>D(t),className:"h-8 w-8",children:(0,a.jsx)($.Z,{className:"h-4 w-4"})})]})]},t)}),(0,a.jsxs)(w,{variant:"outline",className:"w-full",onClick:()=>{f(null),h(""),N(""),v(!0),y(!0)},children:[(0,a.jsx)(M.Z,{className:"h-4 w-4 mr-2"}),"Add Tool"]})]})]}),(0,a.jsx)(w,{className:"w-full mt-4",onClick:R,disabled:"saving"===S||!C,children:"saving"===S?"Saving...":"saved"===S?(0,a.jsxs)("span",{className:"flex items-center",children:["Saved Successfully",(0,a.jsx)(T.Z,{className:"ml-2 h-4 w-4"})]}):"error"===S?"Error Saving":"Save Configuration"})]})})}),(0,a.jsx)(X,{open:j,onOpenChange:y,editingIndex:p,selectedTemplate:b,editingSchemaStr:x,isJsonValid:g,onTemplateChange:e=>{N(e);let t=K.find(t=>t.name===e)||E.find(t=>t.name===e);t&&(h(JSON.stringify(t,null,2)),v(!0))},onSchemaChange:e=>{h(e);try{JSON.parse(e),v(!0)}catch(e){v(!1)}},onSave:()=>{try{JSON.parse(x)}catch(e){return}let e=[...u];null===p?e.push(x):e[p]=x,m(e),y(!1)},backendTools:E})]})},es=s(7390),ea=s(9832),el=s(3045),en=s(8954),ei=e=>{let{items:t}=e,s=(0,l.useRef)(null);(0,l.useEffect)(()=>{var e;null===(e=s.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]);let n=t.filter(e=>"message"===e.type||"function_call"===e.type||"function_call_output"===e.type);return(0,a.jsx)(A,{className:"h-full flex flex-col overflow-hidden",children:(0,a.jsxs)(U,{className:"flex-1 h-full min-h-0 overflow-hidden flex flex-col p-0",children:[0===n.length&&(0,a.jsx)("div",{className:"flex flex-1 h-full items-center justify-center mt-36",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3 justify-center h-full",children:[(0,a.jsx)("div",{className:"h-[140px] w-[140px] rounded-full bg-secondary/20 flex items-center justify-center",children:(0,a.jsx)(es.Z,{className:"h-16 w-16 text-foreground/10 bg-transparent"})}),(0,a.jsxs)("div",{className:"text-center space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-foreground/60",children:"No messages yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Start a call to see the transcript"})]})]})}),(0,a.jsx)(W,{className:"h-full",children:(0,a.jsxs)("div",{className:"flex flex-col gap-6 p-6",children:[n.map((e,t)=>{let s="user"===e.role,l="tool"===e.role,n=s?ea.Z:l?el.Z:en.Z,i=e.content?e.content.map(e=>e.text).join(""):"";return(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"shrink-0 w-8 h-8 rounded-full flex items-center justify-center border ".concat(s?"bg-background border-border":"bg-secondary border-secondary"),children:(0,a.jsx)(n,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,a.jsx)("span",{className:"text-sm font-medium ".concat(s?"text-muted-foreground":"text-foreground"),children:s?"Caller":l?"Tool Response":"Assistant"}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:e.timestamp})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed break-words",children:i})]})]},t)}),(0,a.jsx)("div",{ref:s})]})})]})})};let er=(0,b.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function eo(e){let{className:t,variant:s,...l}=e;return(0,a.jsx)("div",{className:c(er({variant:s}),t),...l})}var ec=e=>{let{items:t,ws:s}=e,[n,i]=(0,l.useState)({}),[r,o]=(0,l.useState)([]);l.useEffect(()=>{function e(){try{let e=window.localStorage.getItem("vehicle_experience_ratings");e&&o(JSON.parse(e))}catch(e){}}e();let t=()=>e();return window.addEventListener("vehicle-experience-updated",t),()=>window.removeEventListener("vehicle-experience-updated",t)},[]);let c=t.filter(e=>"function_call"===e.type).map(e=>{let s=t.filter(t=>"function_call_output"===t.type&&t.call_id===e.call_id)[0],a="completed"===e.status||!!s,l=s?s.output:void 0;return{...e,completed:a,response:l}}),m=(e,t)=>{i(s=>({...s,[e]:t}))},p=e=>{if(!s||s.readyState!==WebSocket.OPEN)return;let t=e.call_id||"";s.send(JSON.stringify({type:"conversation.item.create",item:{type:"function_call_output",call_id:t,output:JSON.stringify(n[t]||"")}})),s.send(JSON.stringify({type:"response.create"}))};return(0,a.jsxs)(A,{className:"flex flex-col h-full relative",children:[(0,a.jsx)(P,{className:"space-y-1.5 pb-0",children:(0,a.jsx)(L,{className:"text-base font-semibold",children:"Function Calls"})}),(0,a.jsxs)(U,{className:"flex-1 p-4",children:[(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsxs)(d,{children:[(0,a.jsx)(u,{asChild:!0,children:(0,a.jsx)(w,{size:"sm",variant:"outline",children:"Ratings"})}),(0,a.jsxs)(f,{className:"max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)(x,{children:(0,a.jsx)(g,{children:"Vehicle Experience Ratings"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[0===r.length&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"No ratings captured yet."}),r.map((e,t)=>(0,a.jsxs)("div",{className:"rounded-md border p-3 text-sm space-y-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.vehicle}),(0,a.jsxs)("div",{className:"flex text-xs gap-2",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Rating:"}),(0,a.jsx)("span",{children:e.rating}),(0,a.jsx)("span",{className:"font-semibold",children:"Time:"}),(0,a.jsx)("span",{children:new Date(e.serverTimestamp||Date.now()).toLocaleString()})]}),(0,a.jsx)("div",{className:"text-muted-foreground whitespace-pre-wrap break-words",children:e.feedback})]},t))]})]})]})}),(0,a.jsx)(W,{className:"h-full",children:(0,a.jsx)("div",{className:"space-y-4",children:c.map(e=>(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)(eo,{variant:e.completed?"default":"secondary",children:e.completed?"Completed":"Pending"})]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground font-mono break-all",children:JSON.stringify(e.params)}),e.completed?(0,a.jsx)("div",{className:"text-sm rounded-md bg-muted p-3",children:JSON.stringify(JSON.parse(e.response||""))}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j,{placeholder:"Enter response",value:n[e.call_id||""]||"",onChange:t=>m(e.call_id||"",t.target.value)}),(0,a.jsx)(w,{variant:"outline",size:"sm",onClick:()=>p(e),disabled:!n[e.call_id||""],className:"w-full",children:"Submit Response"})]})]},e.id))})})]})]})},ed=s(5733),eu=s(7019),em=e=>{let{selectedPhoneNumber:t,allConfigsReady:s,setAllConfigsReady:n}=e,[i,r]=(0,l.useState)(!0),[o,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(!1),[m,p]=(0,l.useState)(null),[f,x]=(0,l.useState)(null),h=!!o&&s&&!d,g=async()=>{if(h){u(!0),p(null),x(null);try{let e=await fetch("/api/twilio/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:o.trim()})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"HTTP ".concat(e.status))}let t=await e.json();p(t.sid||null)}catch(e){x(e.message||"Failed to start call")}finally{u(!1)}}};return(0,a.jsxs)(A,{className:"flex flex-col gap-3 p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Number"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"font-medium w-36",children:i?t||"None":"••••••••••"}),(0,a.jsx)(w,{variant:"ghost",size:"icon",onClick:()=>r(!i),className:"h-8 w-8",children:i?(0,a.jsx)(ed.Z,{className:"h-4 w-4"}):(0,a.jsx)(eu.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s?(0,a.jsx)(k.Z,{className:"text-green-500 w-4 h-4"}):(0,a.jsx)(C.Z,{className:"text-gray-400 w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:s?"Setup Ready":"Setup Not Ready"})]}),(0,a.jsx)(w,{variant:"outline",size:"sm",onClick:()=>n(!1),children:"Checklist"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Dial Destination"}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(j,{placeholder:"+15551234567",value:o,onChange:e=>c(e.target.value),className:"flex-1"}),(0,a.jsxs)(w,{size:"sm",onClick:g,disabled:!h,className:"flex items-center gap-1",children:[d?(0,a.jsx)(S.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(ea.Z,{className:"h-4 w-4"}),d?"Calling...":"Call"]})]}),(0,a.jsxs)("div",{className:"min-h-[18px] text-xs",children:[m&&(0,a.jsxs)("span",{className:"text-green-600",children:["Started call SID: ",m]}),f&&(0,a.jsx)("span",{className:"text-red-600",children:f})]}),!s&&(0,a.jsx)("p",{className:"text-[11px] text-gray-500",children:"Complete setup before placing a call."})]})]})},ep=()=>{let[e,t]=(0,l.useState)(""),[s,i]=(0,l.useState)(!1),[r,o]=(0,l.useState)([]),[c,d]=(0,l.useState)("disconnected"),[u,m]=(0,l.useState)(null);return(0,l.useEffect)(()=>{if(s&&!u){let e=new WebSocket("".concat("https://illumination-engine-test.store/api","/logs"));e.onopen=()=>{console.log("Connected to logs websocket"),d("connected")},e.onmessage=e=>{let t=JSON.parse(e.data);console.log("Received logs event:",t),function(e,t){function s(e){return{object:"realtime.item",timestamp:new Date().toLocaleTimeString(),...e}}let{type:a}=e;switch(a){case"session.created":t([]);break;case"input_audio_buffer.speech_started":{let{item_id:a}=e;t(e=>[...e,s({id:a,type:"message",role:"user",content:[{type:"text",text:"..."}],status:"running"})]);break}case"conversation.item.created":{let{item:a}=e;if("message"===a.type){let e=a.content&&a.content.length>0?a.content:[];t(t=>{let l=t.findIndex(e=>e.id===a.id);if(!(l>=0))return[...t,s({...a,content:e,status:"completed"})];{let s=[...t];return s[l]={...s[l],...a,content:e,status:"completed",timestamp:s[l].timestamp||new Date().toLocaleTimeString()},s}})}else if("function_call_output"===a.type){t(e=>[...e,s({...a,role:"tool",content:[{type:"text",text:"Function call response: ".concat(a.output)}],status:"completed"})].map(e=>e.call_id===a.call_id&&"function_call"===e.type?{...e,status:"completed"}:e));try{let e=JSON.parse(a.output||"{}");if(e&&e.vehicle&&e.rating&&e.feedback){let t="vehicle_experience_ratings",s=window.localStorage.getItem(t),a=s?JSON.parse(s):[];a.push(e),window.localStorage.setItem(t,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("vehicle-experience-updated",{detail:e}))}}catch(e){}}break}case"conversation.item.input_audio_transcription.completed":{let{item_id:s,transcript:a}=e;t(e=>e.map(e=>e.id===s&&"message"===e.type&&"user"===e.role?{...e,content:[{type:"text",text:a}],status:"completed"}:e));break}case"response.content_part.added":{let{item_id:a,part:l,output_index:n}=e;"text"===l.type&&0===n&&t(e=>{let t=e.findIndex(e=>e.id===a);if(!(t>=0))return[...e,s({id:a,type:"message",role:"assistant",content:[{type:l.type,text:l.text}],status:"running"})];{let s=[...e],a=s[t].content||[];return s[t]={...s[t],content:[...a,{type:l.type,text:l.text}]},s}});break}case"response.audio_transcript.delta":{let{item_id:a,delta:l,output_index:n}=e;0===n&&l&&t(e=>{let t=e.findIndex(e=>e.id===a);if(!(t>=0))return[...e,s({id:a,type:"message",role:"assistant",content:[{type:"text",text:l}],status:"running"})];{let s=[...e],a=s[t].content||[];return s[t]={...s[t],content:[...a,{type:"text",text:l}]},s}});break}case"response.output_item.done":{let{item:a}=e;"function_call"===a.type&&(console.log("function_call",a),t(e=>[...e,s({...a,role:"assistant",content:[{type:"text",text:"".concat(a.name,"(").concat(JSON.stringify(JSON.parse(a.arguments)),")")}],status:"running"})]))}}}(t,o)},e.onclose=()=>{console.log("Logs websocket disconnected"),m(null),d("disconnected")},m(e)}},[s,u]),(0,a.jsxs)("div",{className:"h-screen bg-white flex flex-col",children:[(0,a.jsx)(Y,{ready:s,setReady:i,selectedPhoneNumber:e,setSelectedPhoneNumber:t}),(0,a.jsx)(n,{}),(0,a.jsx)("div",{className:"flex-grow p-4 h-full overflow-hidden flex flex-col",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 h-full",children:[(0,a.jsx)("div",{className:"col-span-3 flex flex-col h-full overflow-hidden",children:(0,a.jsx)(et,{callStatus:c,onSave:e=>{if(!u||u.readyState!==WebSocket.OPEN)return console.error("WebSocket is not connected - cannot save configuration"),!1;let t={type:"session.update",session:{...e}};return console.log("Sending update event:",t),u.send(JSON.stringify(t)),!0}})}),(0,a.jsxs)("div",{className:"col-span-6 flex flex-col gap-4 h-full overflow-hidden",children:[(0,a.jsx)(em,{selectedPhoneNumber:e,allConfigsReady:s,setAllConfigsReady:i}),(0,a.jsx)(ei,{items:r})]}),(0,a.jsx)("div",{className:"col-span-3 flex flex-col h-full overflow-hidden",children:(0,a.jsx)(ec,{items:r,ws:u})})]})})]})}}},function(e){e.O(0,[574,971,23,744],function(){return e(e.s=802)}),_N_E=e.O()}]);